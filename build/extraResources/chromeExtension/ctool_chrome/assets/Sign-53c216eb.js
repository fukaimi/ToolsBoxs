import{u as v,i as k}from"./action-282deb75.js";import{c as T,a as b,T as s}from"./index-f90c7143.js";import{s as A}from"./index-636623a5.js";import{A as I,bi as C,k as w,be as H,m as $,bj as a,aF as i,as as z,x as e,a$ as n}from"./history-7dbe2ade.js";import"./_commonjsHelpers-87174ba5.js";import"./index-b1ff2442.js";import"./shim-03580cdb.js";const G=I({__name:"Sign",async setup(E){let p,m;const t=v(([p,m]=C(()=>k({input:T("text"),option:{private_key:"",user_id:"1234567812345678"},output:b("hex")})),p=await p,m(),p)),c=w(()=>{if(t.current.input.text.isEmpty()||t.current.option.private_key==="")return s.empty();if(t.current.input.text.isError())return t.current.input.text;try{return s.fromHex(A.sm2.doSignature(t.current.input.text.toArray(),t.current.option.private_key,{hash:!0,userId:t.current.option.user_id}))}catch(r){return s.fromError($error(r))}});return H(()=>c.value,r=>{r.isEmpty()||t.save()},{immediate:!0,deep:!0}),(r,o)=>{const _=i("TextInput"),d=i("Input"),l=i("Align"),f=i("HelpTip"),x=i("Card"),g=i("TextOutput"),h=i("HeightResize");return z(),$(h,{ignore:"",append:[".ctool-page-option"],reduce:10},{default:a(({small:y,large:V})=>[e(l,{direction:"vertical"},{default:a(()=>[e(_,{modelValue:n(t).current.input,"onUpdate:modelValue":o[0]||(o[0]=u=>n(t).current.input=u),height:y,upload:"file"},null,8,["modelValue","height"]),e(x,{title:r.$t("main_ui_config"),class:"ctool-page-option"},{extra:a(()=>[e(l,null,{default:a(()=>[e(f,{link:"https://github.com/JuneAndGreen/sm-crypto"})]),_:1})]),default:a(()=>[e(l,{horizontal:"center"},{default:a(()=>[e(d,{modelValue:n(t).current.option.private_key,"onUpdate:modelValue":o[1]||(o[1]=u=>n(t).current.option.private_key=u),label:r.$t("sm2_private_key")},null,8,["modelValue","label"]),e(d,{modelValue:n(t).current.option.user_id,"onUpdate:modelValue":o[2]||(o[2]=u=>n(t).current.option.user_id=u),label:r.$t("sm2_userId")},null,8,["modelValue","label"])]),_:1})]),_:1},8,["title"]),e(g,{modelValue:n(t).current.output,"onUpdate:modelValue":o[3]||(o[3]=u=>n(t).current.output=u),allow:["base64","hex"],content:c.value,height:V},null,8,["modelValue","content","height"])]),_:2},1024)]),_:1},8,["append"])}}});export{G as default};
