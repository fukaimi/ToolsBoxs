var R=Object.defineProperty;var L=(s,t,r)=>t in s?R(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var S=(s,t,r)=>(L(s,typeof t!="symbol"?t+"":t,r),r);import{u as F,i as M}from"./action-282deb75.js";import{T as I,c as N}from"./index-f90c7143.js";import{C as $}from"./index-bdc3fa98.js";import{s as P}from"./index-636623a5.js";import{A as G,bi as J,k as V,bl as O,o as B,x as p,bj as c,aF as m,aG as q,as as x,a$ as a,m as k,n as K,F as Q,aD as W}from"./history-7dbe2ade.js";import"./_commonjsHelpers-87174ba5.js";import"./index-b1ff2442.js";import"./shim-03580cdb.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./string_decoder-7fdcd1c7.js";import"./callBound-7203e6b7.js";import"./index-71a93be5.js";const A=["md5","sha1","sha256","sha512","sm3"],C={md5:s=>$.MD5($.enc.Base64.parse(s.toBase64())).toString(),sha1:s=>$.SHA1($.enc.Base64.parse(s.toBase64())).toString(),sha256:s=>$.SHA256($.enc.Base64.parse(s.toBase64())).toString(),sha512:s=>$.SHA512($.enc.Base64.parse(s.toBase64())).toString(),sm3:s=>{const t=(o,h)=>o.length>=h?o:new Array(h-o.length+1).join("0")+o;let r=s.toHex({type:"hex"});const e=[];let n=r.length;n%2!==0&&(r=t(r,n+1)),n=r.length;for(let o=0;o<n;o+=2)e.push(parseInt(r.substr(o,2),16));return P.sm3(e)}};class T{constructor(t="root"){S(this,"parameter",[]);S(this,"flag","");if(!["hash","$input","$salt","root"].includes(t))throw new Error(`Expression Error (${t})`);this.flag=t}add(t){this.parameter.push(t)}toString(){if(this.flag==="root"){let t="";for(let r in this.parameter){const e=this.parameter[r].toString();t+=`${parseInt(r)>0?".":""}${e.toString()}`}return t}if(this.flag==="hash"){let t="";for(let r in this.parameter){const e=this.parameter[r].toString();t+=`${parseInt(r)>0?".":""}${e.toString()}`}return`hash(${t})`}return this.flag}getResult(t,r,e){if(this.flag==="$input")return t;if(this.flag==="$salt")return r;let n=[];for(let o in this.parameter)n.push(this.parameter[o].getResult(t,r,e));return this.flag==="root"?n.join(""):e(I.fromString(n.join("")))}}const X=(s="")=>{const t="__@@@__";s=s.replace(/\(/g,`${t}(${t}`).replace(/\)/g,`${t})${t}`).replace(/\./g,`${t}.${t}`);const r=s.split(t).filter(h=>h!=="");if(!["hash","$input","$salt"].includes(r[0]))throw new Error(`Expression Error ${r[0]}`);let e=new T,n=[e],o=null;for(let h of r){let E=n[n.length-1],_=null;switch(h){case".":break;case"hash":case"$input":case"$salt":_=new T(h),E.add(_),o=_;break;case"(":n.push(o);break;case")":if(n.length===1)throw new Error('Expression Error invalid ")"');n.pop();break;default:throw new Error(`Expression Error invalid "${h}"`)}}if(n.length>1)throw new Error('Expression Error invalid "("');return e},D=(s,t,r="",e="")=>{if(!Object.keys(C).includes(s))throw new Error(`hash method 不存在: ${s}`);const n=o=>C[s](o);return e===""?n(t):X(e).getResult(t.toString(),r,n)},he=G({__name:"Hash",async setup(s){let t,r;const e=F(([t,r]=J(()=>M({input:N(),salt:"",salt_exp:"",is_salt:!1,is_uppercase:!1,multiple:!1})),t=await t,r(),t)),n=V(()=>!e.current.is_salt||["upload","url"].includes(e.current.input.type)?"":e.current.salt_exp||""),o=V(()=>["text"].includes(e.current.input.type)),h=V(()=>{let u={md5:"",sha1:"",sha256:"",sha512:"",sm3:""};if(!e.current.input.text.isEmpty()){let l=!1;for(let f of A)try{if(e.current.input.text.isError())throw new Error(e.current.input.text.toString());const d=E(f,e.current.input.text,e.current.salt,n.value,o.value&&e.current.multiple);u[f]=e.current.is_uppercase?d.toUpperCase():d.toLowerCase()}catch(d){l=!0,u[f]=$error(d)}l||e.save()}return u}),E=(u,l,f,d,g)=>g?l.toString().split(`
`).map(v=>D(u,I.fromString(v,l.encoding()),f,d)).join(`
`):D(u,l,f,d),_=["hash(hash($input))","hash($input.$salt)","hash(hash($input).$salt)","hash($input).hash($salt)","hash(hash(hash($input)))","hash($salt.$input.$salt)","hash(hash($input.$salt).$salt)","hash($salt.hash($input.$salt).$salt)","hash($salt.hash($salt.$input.$salt).$salt)"];return(u,l)=>{const f=m("TextInput"),d=m("HeightResize"),g=m("Bool"),v=m("Tooltip"),w=m("Align"),H=m("Display"),y=m("Input"),U=m("Dropdown"),j=m("Textarea"),z=q("row");return O((x(),B("div",null,[p(w,{direction:"vertical"},{default:c(()=>[p(H,null,{extra:c(()=>[p(w,null,{default:c(()=>[p(g,{size:"small",modelValue:a(e).current.is_salt,"onUpdate:modelValue":l[1]||(l[1]=i=>a(e).current.is_salt=i),border:"",disabled:["upload","url"].includes(a(e).current.input.type),label:u.$t("hash_salt")},null,8,["modelValue","disabled","label"]),p(g,{size:"small",modelValue:a(e).current.is_uppercase,"onUpdate:modelValue":l[2]||(l[2]=i=>a(e).current.is_uppercase=i),border:"",label:u.$t("hash_uppercase")},null,8,["modelValue","label"]),p(v,{content:u.$t("hash_multiple_tooltip")},{default:c(()=>[p(g,{disabled:!o.value,size:"small",modelValue:a(e).current.multiple,"onUpdate:modelValue":l[3]||(l[3]=i=>a(e).current.multiple=i),border:"",label:u.$t("hash_multiple")},null,8,["disabled","modelValue","label"])]),_:1},8,["content"])]),_:1})]),default:c(()=>[p(d,{append:a(e).current.is_salt?[".ctool-hash-salt"]:[],reduce:a(e).current.is_salt?5:0},{default:c(({height:i})=>[p(f,{modelValue:a(e).current.input,"onUpdate:modelValue":l[0]||(l[0]=b=>a(e).current.input=b),height:i,upload:"file",encoding:""},null,8,["modelValue","height"])]),_:1},8,["append","reduce"])]),_:1}),a(e).current.is_salt?(x(),k(w,{key:0,direction:"vertical",class:"ctool-hash-salt"},{default:c(()=>[p(y,{modelValue:a(e).current.salt,"onUpdate:modelValue":l[4]||(l[4]=i=>a(e).current.salt=i),label:u.$t("hash_salt_value"),disabled:["upload","url"].includes(a(e).current.input.type)},null,8,["modelValue","label","disabled"]),p(y,{modelValue:a(e).current.salt_exp,"onUpdate:modelValue":l[6]||(l[6]=i=>a(e).current.salt_exp=i),label:u.$t("hash_salt_mode"),disabled:["upload","url"].includes(a(e).current.input.type)},{append:c(()=>[p(U,{disabled:["upload","url"].includes(a(e).current.input.type),onSelect:l[5]||(l[5]=i=>a(e).current.salt_exp=i),placeholder:u.$t("hash_salt_select"),options:_},null,8,["disabled","placeholder"])]),_:1},8,["modelValue","label","disabled"])]),_:1})):K("",!0)]),_:1}),p(d,null,{default:c(({height:i})=>[p(w,{direction:"vertical"},{default:c(()=>[(x(!0),B(Q,null,W(a(A),b=>(x(),k(j,{"model-value":h.value[b],height:(i-20)/5,placeholder:b,copy:b},null,8,["model-value","height","placeholder","copy"]))),256))]),_:2},1024)]),_:1})])),[[z,"10-14"]])}}});export{he as default};
